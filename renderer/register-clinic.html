<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule</title>
    <link rel="stylesheet" href="./styles/register-clinic.css">
</head>
<body>
    <form id="register-clinic">
        <div id="img-wrapper">
            <label for="clinic-img">
                <img id="preview-img" src="../assets/img_icon.png" alt="Preview Image" title="Prévia de Ícone">
            </label>
        </div>
        <input id="clinic-img" type="file">
        <input id="clinic-name" type="text" placeholder="Digite o nome da clínica">
        <input class="button" type="submit" value="Cadastrar" accept="image/*">
    </form>

    <script>

        const fileInput = document.getElementById('clinic-img')
        const preview = document.getElementById('preview-img')

        fileInput.addEventListener('change', () => {
            const file = fileInput.files[0]
            
            if(file) {
                const reader = new FileReader()
                reader.onload = (event) => {
                    preview.src = event.target.result
                    preview.style.padding = 0
                    preview.style.width = "170px"
                    preview.style.height = "170px"
                }

                reader.readAsDataURL(file)
            }
        })

        const form = document.getElementById('register-clinic')
        form.addEventListener('submit', async (event) => {
            event.preventDefault()
            const name = document.getElementById('clinic-name').value
            const img = document.getElementById('clinic-img').files[0].name

            try {
                await window.clinicAPI.createClinic({name, img})
                alert('Clínica cadastrada com sucesso!')
                window.location.href = 'register-professional.html'
            } catch (err) {
                console.log(err)
                alert('Erro ao cadastrar clínica - Tente Novamente')
            }
        })
    </script>
</body>
</html>